.include "m32def.inc"
		LDI		R16,HIGH(RAMEND)
		OUT		SPH,R16
		LDI		R16,LOW(RAMEND)
		OUT		SPL,R16

		LDI		R16,0xFF
		OUT		DDRC,R16
		OUT		DDRD,R16
		LDI		R20,0b11111110
		LDI		R21,0b11111101
		LDI		R22,0b11111011
		LDI		R23,0b11110111

START:
		CALL	PROC
		IN R26,PINA
		ANDI R26,0b00000001
		brne L2
		L1:
			call ROTREG2
			RJMP START
		L2:
			CALL ROTREG1
			RJMP START
		


PROC:	LDI R27,25
	TMP1: 
		MOV		R16,R20
		OUT		PORTD,R16
		LDI		R16,0b00000110
		OUT		PORTC,R16
		CALL	DELAY

		MOV		R16,R21
		OUT		PORTD,R16
		LDI		R16,0b01100110
		OUT		PORTC,R16
		CALL	DELAY

		MOV		R16,R22
		OUT		PORTD,R16
		LDI		R16,0b00111111
		OUT		PORTC,R16
		CALL	DELAY

		MOV		R16,R23
		OUT		PORTD,R16
		LDI		R16,0b01001111
		OUT		PORTC,R16
		CALL	DELAY
		
		DEC R27
		brne TMP1
		
	ret
		


ROTREG1:
		MOV	R24,R23
		MOV R23,R22
		MOV R22,R21
		MOV R21,R20
		MOV R20,R24
		ret
ROTREG2:
		MOV	R24,R20
		MOV R20,R21
		MOV R21,R22
		MOV R22,R23
		MOV R23,R24
		ret

	
DELAY:	LDI		R17,100
D1:		LDI		R18,20
D2:		DEC		R18
		BRNE	D2
		DEC		R17
		BRNE	D1
		RET
